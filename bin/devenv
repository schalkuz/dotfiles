#!/bin/bash

# Development Environment Helper
# Usage: devenv [command]

# Source gvm if available
[[ -s "$HOME/.gvm/scripts/gvm" ]] && source "$HOME/.gvm/scripts/gvm"

case "$1" in
    status|info)
        echo "ðŸ”§ Development Environment Status"
        echo "=================================="
        echo ""
        echo "ðŸ Python (UV managed):"
        uv python list | grep -v "download available" | head -5
        echo ""
        echo "ðŸŸ¢ Node.js (NVM managed):"
        echo "  Current: $(nvm current)"
        echo "  Available: $(nvm list | tr '\n' ' ')"
        echo ""
        echo "ðŸ”µ Go (GVM managed):"
        echo "  Current: $(go version 2>/dev/null || echo 'Not active')"
        echo "  Available: $(gvm list 2>/dev/null | tr '\n' ' ' || echo 'Run: gvm list')"
        echo ""
        echo "âš™ï¸  C/C++ Tools:"
        echo "  GCC/Clang: $(gcc --version | head -1)"
        echo "  CMake: $(cmake --version | head -1)"
        echo "  pkg-config: v$(pkg-config --version)"
        echo ""
        echo "ðŸ”· .NET SDKs:"
        if command -v dotnet >/dev/null 2>&1; then
            echo "  Current: $(dotnet --version 2>/dev/null || echo 'Not active')"
            echo "  Available: $(dotnet --list-sdks 2>/dev/null | awk '{print $1}' | tr '\n' ' ' || echo 'None')"
        else
            echo "  Not installed"
        fi
        echo ""
        ;;
    python|py)
        case "$2" in
            install)
                echo "Installing Python $3..."
                uv python install "$3"
                ;;
            list)
                uv python list
                ;;
            use)
                echo "To use a specific Python version in a project:"
                echo "  cd your-project"
                echo "  uv python pin $3"
                ;;
            *)
                echo "Python (UV) commands:"
                echo "  devenv python install 3.11  # Install Python 3.11"
                echo "  devenv python list          # List available Python versions"
                echo "  devenv python use 3.11      # Pin Python version in project"
                echo ""
                echo "Common UV commands:"
                echo "  uv init                      # Initialize new Python project"
                echo "  uv add requests              # Add dependency"
                echo "  uv run python script.py     # Run Python script"
                ;;
        esac
        ;;
    node|js)
        case "$2" in
            install)
                nvm install "$3"
                ;;
            use)
                nvm use "$3"
                ;;
            list)
                nvm list
                ;;
            *)
                echo "Node.js (NVM) commands:"
                echo "  devenv node install 20      # Install Node.js v20"
                echo "  devenv node use 18          # Switch to Node.js v18"
                echo "  devenv node list            # List installed versions"
                echo ""
                echo "Current version: $(nvm current)"
                ;;
        esac
        ;;
    go)
        case "$2" in
            install)
                gvm install "go$3" -B
                ;;
            use)
                # Remove 'go' prefix if present
                version="${3#go}"
                gvm use "go$version" --default
                ;;
            list)
                gvm list
                ;;
            *)
                echo "Go (GVM) commands:"
                echo "  devenv go install 1.21.0    # Install Go 1.21.0"
                echo "  devenv go use 1.21.0        # Switch to Go 1.21.0"
                echo "  devenv go list              # List installed versions"
                echo ""
                echo "Current version: $(go version 2>/dev/null || echo 'Not set')"
                ;;
        esac
        ;;
    c|cpp)
        echo "C/C++ Development Tools:"
        echo "========================"
        echo "Compilers:"
        echo "  gcc, clang    - C/C++ compilers"
        echo "  g++, clang++  - C++ compilers"
        echo ""
        echo "Build Tools:"
        echo "  make          - Build automation"
        echo "  cmake         - Cross-platform build system"
        echo "  pkg-config    - Library metadata tool"
        echo ""
        echo "Example usage:"
        echo "  gcc -o hello hello.c"
        echo "  clang++ -o app main.cpp"
        echo "  cmake ."
        echo "  make"
        ;;
    dotnet|net)
        echo ".NET Development:"
        echo "================="
        echo "SDK Management:"
        echo "  dotnet --list-sdks           # List installed SDKs"
        echo "  dotnet --version             # Show current version"
        echo ""
        echo "Project Management:"
        echo "  dotnet new console           # Create console app"
        echo "  dotnet new webapi            # Create web API"
        echo "  dotnet new blazor            # Create Blazor app"
        echo "  dotnet add package <pkg>     # Add NuGet package"
        echo ""
        echo "Build & Run:"
        echo "  dotnet build                 # Build project"
        echo "  dotnet run                   # Run project"
        echo "  dotnet test                  # Run tests"
        echo ""
        echo "Current SDKs:"
        if command -v dotnet >/dev/null 2>&1; then
            dotnet --list-sdks
        else
            echo "  .NET not installed"
        fi
        ;;
    nvim|neovim)
        echo "Neovim Development Environment:"
        echo "=============================="
        echo "Configuration: AstroNvim with comprehensive language support"
        echo ""
        echo "Key Features:"
        echo "  â€¢ Tokyo Night Dark theme"
        echo "  â€¢ Harpoon for quick file navigation"
        echo "  â€¢ Telescope for fuzzy finding"
        echo "  â€¢ Language servers for all installed languages"
        echo "  â€¢ Git integration with blame and diff views"
        echo ""
        echo "Key Bindings:"
        echo "  <Space>ff      - Find files"
        echo "  <Space>fg      - Live grep (search in files)"
        echo "  <Space>fb      - Browse buffers"
        echo "  <Space>ha      - Add file to Harpoon"
        echo "  <Space>hh      - Toggle Harpoon menu"
        echo "  <Space>h1-4    - Navigate to Harpoon files"
        echo "  <Space>e       - Toggle file explorer"
        echo "  <Space>gg      - Open Lazygit"
        echo "  <Space>t       - Open terminal"
        echo ""
        echo "Current status:"
        if command -v nvim >/dev/null 2>&1; then
            echo "  Version: $(nvim --version | head -1)"
            echo "  Config: ~/.config/nvim (AstroNvim)"
            echo "  Font: JetBrains Mono Nerd Font (recommended)"
        else
            echo "  Neovim not installed"
        fi
        ;;
    *)
        echo "ðŸ”§ Development Environment Manager"
        echo "=================================="
        echo ""
        echo "Commands:"
        echo "  devenv status     - Show all installed tools"
        echo "  devenv python     - Python/UV management"
        echo "  devenv node       - Node.js/NVM management" 
        echo "  devenv go         - Go/GVM management"
        echo "  devenv c          - C/C++ tools info"
        echo "  devenv dotnet     - .NET development info"
        echo "  devenv nvim       - Neovim configuration info"
        echo ""
        echo "Quick status:"
        echo "  Python: $(uv python list | grep -v "download available" | head -1 | awk '{print $1}' || echo 'Not installed')"
        echo "  Node.js: $(nvm current 2>/dev/null || echo 'Not installed')"
        echo "  Go: $(go version 2>/dev/null | awk '{print $3}' || echo 'Not installed')"
        echo "  C/C++: $(gcc --version 2>/dev/null | head -1 | awk '{print $4}' || echo 'Not installed')"
        echo "  .NET: $(dotnet --version 2>/dev/null || echo 'Not installed')"
        echo "  Neovim: $(nvim --version 2>/dev/null | head -1 | awk '{print $2}' || echo 'Not installed')"
        ;;
esac
